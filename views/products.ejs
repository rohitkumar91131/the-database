<%- include('partials/header') %>

<style>
    /* 1. Blur-Up Styling */
    .blur-container {
        position: relative;
        overflow: hidden;
        background-color: #f3f4f6; /* Image aane tak base color */
    }

    .placeholder-img {
        filter: blur(20px);
        transform: scale(1.1);
        transition: opacity 0.6s ease-in-out;
        z-index: 1;
    }

    .main-img {
        transition: opacity 0.8s ease-in-out, transform 0.5s ease;
        z-index: 2;
    }

    /* Jab high-res load ho jaye toh placeholder hide kar do */
    .blur-container.loaded .placeholder-img {
        opacity: 0;
    }

    /* 2. Shimmer Effect Overlay */
    .shimmer-overlay {
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.4),
            transparent
        );
        animation: shimmer-animation 1.5s infinite;
        z-index: 3;
    }

    .blur-container.loaded .shimmer-overlay {
        display: none;
    }

    @keyframes shimmer-animation {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6">
        <div class="animate-fade-in-up">
            <h1 class="text-4xl font-black text-white tracking-tighter">GLOBAL <span class="text-pink-500 neon-text-pink uppercase italic">Gear</span></h1>
            <p class="text-gray-500 mt-2 font-medium tracking-wide">Syncing physical assets with the Nexus Core Database.</p>
        </div>

        <form action="/products" method="GET" class="relative w-full max-w-md group">
            <div class="absolute -inset-0.5 bg-pink-500/20 rounded-xl blur group-hover:opacity-100 transition duration-500"></div>
            <div class="relative flex items-center bg-[#0f172a] border border-gray-800 rounded-xl px-4 py-3 focus-within:border-pink-500 transition-colors">
                <i class="fa-solid fa-magnifying-glass text-gray-500 mr-3"></i>
                <input type="text" name="search" value="<%= search %>" placeholder="Search gear..." 
                       class="w-full bg-transparent text-white outline-none placeholder-gray-600 font-medium">
            </div>
        </form>
    </div>

    <div class="flex flex-wrap gap-3 mb-12 scrollbar-hide">
        <% const categories = ['electronics', 'jewelery', "men's clothing", "women's clothing"]; %>
        <a href="/products" class="px-6 py-2 rounded-full border <%= !search ? 'bg-pink-600 border-pink-600 text-white shadow-lg shadow-pink-600/20' : 'border-gray-800 text-gray-400 hover:border-pink-500' %> text-[10px] font-black transition uppercase tracking-[0.2em]">All Systems</a>
        
        <% categories.forEach(cat => { %>
            <a href="/products?search=<%= cat %>" 
               class="px-6 py-2 rounded-full border <%= search === cat ? 'bg-pink-600 border-pink-600 text-white shadow-lg shadow-pink-600/20' : 'border-gray-800 text-gray-400 hover:border-pink-500' %> text-[10px] font-black transition uppercase tracking-[0.2em]">
               <%= cat %>
            </a>
        <% }) %>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
        <% products.forEach(product => { %>
            <a href="/products/<%= product._id %>" class="group bg-[#0f172a]/60 backdrop-blur-md rounded-2xl border border-gray-800 overflow-hidden hover:border-pink-500/50 transition duration-500 hover:-translate-y-2 flex flex-col">
                
                <div class="aspect-square bg-white relative overflow-hidden flex items-center justify-center p-8 blur-container">
                    <div class="shimmer-overlay"></div>

                    <img src="<%= product.imageBlur %>" 
                         class="absolute inset-0 w-full h-full object-cover placeholder-img" 
                         alt="loading...">

                    <img src="<%= product.image %>" 
                         class="max-h-full max-w-full object-contain z-10 opacity-0 main-img group-hover:scale-110" 
                         onload="revealImage(this)">

                    <div class="absolute top-4 right-4 z-20 bg-black/90 text-pink-400 text-xs font-black px-3 py-1.5 rounded-full border border-pink-500/30 shadow-xl">
                        $<%= product.price.toFixed(2) %>
                    </div>
                </div>

                <div class="p-6 flex-grow flex flex-col border-t border-gray-800/50">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-[9px] uppercase text-pink-500 font-black tracking-widest bg-pink-500/10 px-2 py-0.5 rounded border border-pink-500/10">
                            <%= product.category %>
                        </span>
                        <div class="flex items-center text-yellow-500 text-xs font-black">
                            <i class="fa-solid fa-star mr-1 text-[10px]"></i>
                            <%= product.rating.rate %>
                        </div>
                    </div>
                    <h3 class="text-white font-bold text-sm line-clamp-2 mb-4 group-hover:text-pink-400 transition-colors duration-300">
                        <%= product.title %>
                    </h3>
                    
                    <div class="mt-auto">
                        <div class="w-full py-3 rounded-xl bg-gray-900 border border-gray-800 text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] group-hover:bg-pink-600 group-hover:text-white group-hover:border-pink-600 text-center transition-all duration-500">
                            Inspect Asset
                        </div>
                    </div>
                </div>
            </a>
        <% }) %>
    </div>

    <% if (totalPages > 1) { %>
    <div class="mt-24 flex justify-center items-center gap-8 animate-fade-in-up">
        <% if (currentPage > 1) { %>
            <a href="/products?page=<%= currentPage - 1 %>&search=<%= search %>" class="group flex items-center text-gray-600 hover:text-pink-500 transition-all font-black text-xs tracking-widest uppercase">
                <i class="fa-solid fa-chevron-left mr-2 group-hover:-translate-x-1 transition-transform"></i> Prev
            </a>
        <% } %>
        
        <div class="px-6 py-2 rounded-full border border-gray-800 bg-gray-900/50 text-gray-400 text-[10px] font-black tracking-[0.3em]">
            SYSTEM_PAGE: <%= currentPage %> / <%= totalPages %>
        </div>

        <% if (currentPage < totalPages) { %>
            <a href="/products?page=<%= currentPage + 1 %>&search=<%= search %>" class="group flex items-center text-gray-600 hover:text-pink-500 transition-all font-black text-xs tracking-widest uppercase">
                Next <i class="fa-solid fa-chevron-right ml-2 group-hover:translate-x-1 transition-transform"></i>
            </a>
        <% } %>
    </div>
    <% } %>
</div>

<script>
    // Blur-to-Sharp Transition Handler
    function revealImage(img) {
        const container = img.parentElement;
        // Step 1: Reveal high-res image
        img.classList.remove('opacity-0');
        // Step 2: Hide placeholder and shimmer
        setTimeout(() => {
            container.classList.add('loaded');
        }, 100); // Thoda buffer mast transition ke liye
    }
</script>

<%- include('partials/footer') %>